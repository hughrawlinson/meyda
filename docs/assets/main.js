var meydaDemo=function(){"use strict";var e={exports:{}};return function(){var t;const o=function(e){window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext),navigator.hasOwnProperty("webkitGetUserMedia")&&!navigator.hasOwnProperty("getUserMedia")&&(navigator.getUserMedia=webkitGetUserMedia,AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode)),this.context=new AudioContext;let o=document.getElementById("elvisSong"),n=this.context.createMediaElementSource(o);n.connect(this.context.destination),this.meyda=Meyda.createMeydaAnalyzer({audioContext:this.context,source:n,bufferSize:e,windowingFunction:"blackman"}),t=this,this.initializeMicrophoneSampling()};o.prototype.initializeMicrophoneSampling=function(){var e=function(e){if("suspended"===t.context.state){var o=function(){t.context.resume(),setTimeout((function(){"running"===t.context.state&&document.body.removeEventListener("touchend",o,!1)}),0)};document.body.addEventListener("touchend",o,!1)}};try{navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia||navigator.mediaDevices.getUserMedia;var o=function(e){document.getElementById("audioControl").style.display="none",console.log("User allowed microphone access."),console.log("Initializing AudioNode from MediaStream");var o=t.context.createMediaStreamSource(e);console.log("Setting Meyda Source to Microphone"),t.meyda.setSource(o),console.groupEnd()};console.log("Asking for permission..."),navigator.mediaDevices.getUserMedia({audio:!0}).then(o).catch((function(t){console.log(t),navigator.getUserMedia({audio:!0},o,(function(t){e()}))}))}catch(t){e()}},o.prototype.get=function(e){return t.context.resume(),t.meyda.get(e)},e.exports=o}(),function(){var t=["C","C#","D","Eb","E","F","F#","G","G#","A","Bb","B"];const o=1024;let n=new(0,e.exports)(o);var r=new THREE.Scene,i=new THREE.PerspectiveCamera(40,1.6,.1,1e3),a=new THREE.LineBasicMaterial({color:65280});new THREE.LineBasicMaterial({color:65535});var c=function(e,t){for(var o=[],n=0;n<e;n++)o.push(Array.apply(null,Array(t)).map(Number.prototype.valueOf,0));return o}(20,o),s=new THREE.WebGLRenderer({canvas:document.querySelector("canvas")});function d(){s.domElement.style.width="100%",s.domElement.style.height="auto";var e=s.domElement.clientWidth/16*10;s.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1),s.setSize(1.6*e,e),s.domElement.style.width="100%",s.domElement.style.height="auto",i.aspect=1.6*e/e,i.updateProjectionMatrix()}d(),window.addEventListener("resize",d);var l=new THREE.DirectionalLight(16777215,.5);l.position.set(0,1,1),r.add(l),i.position.z=5;const u=new THREE.Vector3(0,1,0),m=new THREE.Vector3(1,0,0),p=new THREE.Vector3(1,-6,-15);let g=new THREE.ArrowHelper(u,p,1,16776960),w=new THREE.ArrowHelper(u,p,1,255),y=new THREE.ArrowHelper(m,p,1,16711935),E=new THREE.Group;r.add(g),r.add(w),r.add(y);for(let e=0;e<c.length;e++)if(c[e]){let t=new THREE.BufferGeometry,o=new Float32Array(3*c[e].length);t.addAttribute("position",new THREE.BufferAttribute(o,3)),t.setDrawRange(0,c[e].length);let n=new THREE.Line(t,a);E.add(n),o=n.geometry.attributes.position.array}let f=new THREE.BufferGeometry,h=new THREE.Line(f,a);{let e=new Float32Array(3072);f.addAttribute("position",new THREE.BufferAttribute(e,3)),f.setDrawRange(0,o),e=h.geometry.attributes.position.array}r.add(h),r.add(E);let v=null,b=document.querySelector("#chroma"),M=document.querySelector("#mfcc");!function e(){if(v=n.get(["amplitudeSpectrum","spectralCentroid","spectralRolloff","loudness","rms","chroma","mfcc"]),v){b&&v.chroma&&(b.innerHTML=v.chroma.reduce(((e,o,n)=>`${e}\n          <div class="chroma-band" style="background-color: rgba(0,${Math.round(255*o)},0,1)">${t[n]}</div>`),"")),M&&v.mfcc&&(M.innerHTML=v.mfcc.reduce(((e,t,o)=>`${e}\n          <div class="mfcc-band" style="background-color: rgba(0,${5*Math.round(t+25)},0,1)">${o}</div>`),"")),c.pop(),c.unshift(v.amplitudeSpectrum);const e=n.meyda._m.signal;for(let e=0;e<c.length;e++){for(var a=E.children[e].geometry.attributes.position.array,d=0,l=0;l<3*c[e].length;l++)a[d++]=10.7+8*Math.log10(l/c[e].length),a[d++]=.1*c[e][l]-5,a[d++]=-15-e;E.children[e].geometry.attributes.position.needsUpdate=!0}if(v.spectralCentroid&&g.position.set(10.7+8*Math.log10(v.spectralCentroid/512),-6,-15),v.spectralRolloff){var u=v.spectralRolloff/22050;w.position.set(10.7+8*Math.log10(u),-6,-15)}if(v.rms&&y.position.set(-11,10*v.rms-5,-15),e){let t=h.geometry.attributes.position.array,n=0;for(var m=0;m<o;m++)t[n++]=22*m/o-11,t[n++]=4+5*e[m],t[n++]=-25;h.geometry.attributes.position.needsUpdate=!0}}requestAnimationFrame(e),s.render(r,i)}()}(),{}}();
